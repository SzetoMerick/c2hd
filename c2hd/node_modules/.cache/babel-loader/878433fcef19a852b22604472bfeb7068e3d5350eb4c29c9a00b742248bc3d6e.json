{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getHandlers = exports.init = void 0;\nconst logger_1 = require(\"./logger\");\nconst logger = (0, logger_1.getInstance)();\nfunction init(proxy, option) {\n  const handlers = getHandlers(option);\n  for (const eventName of Object.keys(handlers)) {\n    proxy.on(eventName, handlers[eventName]);\n  }\n  // https://github.com/webpack/webpack-dev-server/issues/1642\n  proxy.on('econnreset', (error, req, res, target) => {\n    logger.error(`[HPM] ECONNRESET: %O`, error);\n  });\n  // https://github.com/webpack/webpack-dev-server/issues/1642#issuecomment-1104325120\n  proxy.on('proxyReqWs', (proxyReq, req, socket, options, head) => {\n    socket.on('error', error => {\n      logger.error(`[HPM] WebSocket error: %O`, error);\n    });\n  });\n  logger.debug('[HPM] Subscribed to http-proxy events:', Object.keys(handlers));\n}\nexports.init = init;\nfunction getHandlers(options) {\n  // https://github.com/nodejitsu/node-http-proxy#listening-for-proxy-events\n  const proxyEventsMap = {\n    error: 'onError',\n    proxyReq: 'onProxyReq',\n    proxyReqWs: 'onProxyReqWs',\n    proxyRes: 'onProxyRes',\n    open: 'onOpen',\n    close: 'onClose'\n  };\n  const handlers = {};\n  for (const [eventName, onEventName] of Object.entries(proxyEventsMap)) {\n    // all handlers for the http-proxy events are prefixed with 'on'.\n    // loop through options and try to find these handlers\n    // and add them to the handlers object for subscription in init().\n    const fnHandler = options ? options[onEventName] : null;\n    if (typeof fnHandler === 'function') {\n      handlers[eventName] = fnHandler;\n    }\n  }\n  // add default error handler in absence of error handler\n  if (typeof handlers.error !== 'function') {\n    handlers.error = defaultErrorHandler;\n  }\n  // add default close handler in absence of close handler\n  if (typeof handlers.close !== 'function') {\n    handlers.close = logClose;\n  }\n  return handlers;\n}\nexports.getHandlers = getHandlers;\nfunction defaultErrorHandler(err, req, res) {\n  // Re-throw error. Not recoverable since req & res are empty.\n  if (!req && !res) {\n    throw err; // \"Error: Must provide a proper URL as target\"\n  }\n\n  const host = req.headers && req.headers.host;\n  const code = err.code;\n  if (res.writeHead && !res.headersSent) {\n    if (/HPE_INVALID/.test(code)) {\n      res.writeHead(502);\n    } else {\n      switch (code) {\n        case 'ECONNRESET':\n        case 'ENOTFOUND':\n        case 'ECONNREFUSED':\n        case 'ETIMEDOUT':\n          res.writeHead(504);\n          break;\n        default:\n          res.writeHead(500);\n      }\n    }\n  }\n  res.end(`Error occurred while trying to proxy: ${host}${req.url}`);\n}\nfunction logClose(req, socket, head) {\n  // view disconnected websocket connections\n  logger.info('[HPM] Client disconnected');\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","getHandlers","init","logger_1","require","logger","getInstance","proxy","option","handlers","eventName","keys","on","error","req","res","target","proxyReq","socket","options","head","debug","proxyEventsMap","proxyReqWs","proxyRes","open","close","onEventName","entries","fnHandler","defaultErrorHandler","logClose","err","host","headers","code","writeHead","headersSent","test","end","url","info"],"sources":["D:/Documents/VS Code Projects/c2hd/c2hd/node_modules/http-proxy-middleware/dist/_handlers.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.getHandlers = exports.init = void 0;\r\nconst logger_1 = require(\"./logger\");\r\nconst logger = (0, logger_1.getInstance)();\r\nfunction init(proxy, option) {\r\n    const handlers = getHandlers(option);\r\n    for (const eventName of Object.keys(handlers)) {\r\n        proxy.on(eventName, handlers[eventName]);\r\n    }\r\n    // https://github.com/webpack/webpack-dev-server/issues/1642\r\n    proxy.on('econnreset', (error, req, res, target) => {\r\n        logger.error(`[HPM] ECONNRESET: %O`, error);\r\n    });\r\n    // https://github.com/webpack/webpack-dev-server/issues/1642#issuecomment-1104325120\r\n    proxy.on('proxyReqWs', (proxyReq, req, socket, options, head) => {\r\n        socket.on('error', (error) => {\r\n            logger.error(`[HPM] WebSocket error: %O`, error);\r\n        });\r\n    });\r\n    logger.debug('[HPM] Subscribed to http-proxy events:', Object.keys(handlers));\r\n}\r\nexports.init = init;\r\nfunction getHandlers(options) {\r\n    // https://github.com/nodejitsu/node-http-proxy#listening-for-proxy-events\r\n    const proxyEventsMap = {\r\n        error: 'onError',\r\n        proxyReq: 'onProxyReq',\r\n        proxyReqWs: 'onProxyReqWs',\r\n        proxyRes: 'onProxyRes',\r\n        open: 'onOpen',\r\n        close: 'onClose',\r\n    };\r\n    const handlers = {};\r\n    for (const [eventName, onEventName] of Object.entries(proxyEventsMap)) {\r\n        // all handlers for the http-proxy events are prefixed with 'on'.\r\n        // loop through options and try to find these handlers\r\n        // and add them to the handlers object for subscription in init().\r\n        const fnHandler = options ? options[onEventName] : null;\r\n        if (typeof fnHandler === 'function') {\r\n            handlers[eventName] = fnHandler;\r\n        }\r\n    }\r\n    // add default error handler in absence of error handler\r\n    if (typeof handlers.error !== 'function') {\r\n        handlers.error = defaultErrorHandler;\r\n    }\r\n    // add default close handler in absence of close handler\r\n    if (typeof handlers.close !== 'function') {\r\n        handlers.close = logClose;\r\n    }\r\n    return handlers;\r\n}\r\nexports.getHandlers = getHandlers;\r\nfunction defaultErrorHandler(err, req, res) {\r\n    // Re-throw error. Not recoverable since req & res are empty.\r\n    if (!req && !res) {\r\n        throw err; // \"Error: Must provide a proper URL as target\"\r\n    }\r\n    const host = req.headers && req.headers.host;\r\n    const code = err.code;\r\n    if (res.writeHead && !res.headersSent) {\r\n        if (/HPE_INVALID/.test(code)) {\r\n            res.writeHead(502);\r\n        }\r\n        else {\r\n            switch (code) {\r\n                case 'ECONNRESET':\r\n                case 'ENOTFOUND':\r\n                case 'ECONNREFUSED':\r\n                case 'ETIMEDOUT':\r\n                    res.writeHead(504);\r\n                    break;\r\n                default:\r\n                    res.writeHead(500);\r\n            }\r\n        }\r\n    }\r\n    res.end(`Error occurred while trying to proxy: ${host}${req.url}`);\r\n}\r\nfunction logClose(req, socket, head) {\r\n    // view disconnected websocket connections\r\n    logger.info('[HPM] Client disconnected');\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}